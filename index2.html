<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LP DOWNLOADER V4</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<style>
:root{
--bg:#000;
--card:#141414;
--red:#ff0000;
--gray:#888;
--blue:#3b82f6;
--green:#22c55e;
--text:#fff;
--caraText:#fff;
}
*{box-sizing:border-box;}
html,body{margin:0;padding:0;height:100%;display:flex;justify-content:center;align-items:flex-start;background:var(--bg);color:var(--text);font-family:Segoe UI,sans-serif;overflow:hidden;}
#opening{position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;text-align:center;}
#opening video{width:70%;max-width:320px;border-radius:16px;margin-bottom:20px;}
#opening span{display:block;margin-top:5px;font-size:16px;color:var(--text);}
.spinner{width:50px;height:50px;border:6px solid #444;border-top:6px solid var(--red);border-radius:50%;animation:spin 1s linear infinite;margin-top:10px;}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
.container{width:100%;max-width:420px;padding:20px;display:none;overflow-y:auto;max-height:100vh;padding-bottom:260px;transition: background .3s,color .3s;}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px;}
.menu,.update{font-size:22px;cursor:pointer;display:flex;align-items:center;gap:10px;}
.modal{position:fixed;top:50%; left:50%;transform:translate(-50%,-50%);background:#111;border-radius:16px;padding:20px;width:90%; max-width:350px;display:none;z-index:9999;box-shadow:0 0 15px rgba(0,0,0,0.5);}
.modal-close{position:absolute;top:10px;right:14px;font-size:18px;cursor:pointer;color:#fff;}
.modal h3{margin-top:0;margin-bottom:10px;font-size:16px;}
.modal p{font-size:13px;color:#bbb;line-height:1.4;}
.owner{background:linear-gradient(90deg,#800000,#ff0000);border-radius:20px;padding:20px;display:flex;justify-content:space-between;margin-bottom:15px;}
.badge{margin-top:8px;font-size:10px;padding:5px 12px;border-radius:20px;background:rgba(0,0,0,.5);display:inline-block;}
.box{background:var(--card);padding:20px;border-radius:20px;border:1px solid #333;}
input,select{width:100%;padding:12px;border-radius:10px;background:#000;border:1px solid #444;color:#fff;margin-bottom:10px;}
button{width:100%;padding:12px;border:none;border-radius:10px;background:var(--red);color:#fff;font-weight:bold;cursor:pointer;}
button:disabled{opacity:.6;}
#preview{display:none;margin-top:15px;}
#preview video{width:100%;aspect-ratio:16/9;border-radius:14px;background:#000;}
#title{font-size:13px;margin-top:8px;color:#ddd;display:inline-block;}
#copyTitleBtn{padding:4px 8px;margin-left:8px;font-size:12px;border-radius:6px;background:var(--blue);color:#fff;cursor:pointer;}
#result{display:none;text-align:center;margin-top:15px;}
#result a{display:block;margin-top:10px;color:var(--blue);font-weight:bold;text-decoration:none;}
.ready{font-size:12px;color:var(--green);}
.tip{font-size:11px;color:#888;}
.grid{margin-top:15px;display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.stat{background:var(--card);border-radius:15px;padding:15px;}
.label{font-size:12px;color:var(--gray);}
.val{font-size:18px;font-weight:bold;margin-top:5px;}
.blue{color:var(--blue);}
.green{color:var(--green);}
#caraPenggunaan{margin-top:20px;background:var(--card);padding:15px;border-radius:15px;font-size:13px;line-height:1.5;color:var(--caraText);}
#caraPenggunaan b{color:var(--text);}
#waContainer{position:fixed;bottom:20px;right:20px;display:none;flex-direction:column;align-items:center;gap:5px;z-index:9999;background:rgba(0,0,0,0.6);padding:10px 15px;border-radius:12px;backdrop-filter:blur(5px);}
#waText{color:#fff;font-size:14px;font-weight:bold;margin-bottom:5px;}
#waButtons{display:flex;gap:10px;}
.waBtn img{width:50px;height:50px;border-radius:50%;box-shadow:0 4px 8px rgba(0,0,0,0.3);transition: transform 0.2s;}
.waBtn img:hover{transform:scale(1.1);}
#themeToggle{padding:6px 12px;border-radius:8px;background:rgba(59,130,246,0.6);color:#fff;cursor:pointer;font-size:14px;display:flex;align-items:center;}
</style>
</head>
<body>

<div id="opening">
<video autoplay muted loop>
<source src="https://ar-hosting.pages.dev/1770287179319.mp4" type="video/mp4">
</video>
<span>LP DOWNLOADER V4</span>
<span>WAIT LOADING</span>
<div class="spinner"></div>
<h3>DEVELOPER:<span>@Vitz<span>@Ady<span></div>

<div class="container" id="app">
<div class="header">
<div style="display:flex;align-items:center;gap:10px;">
<span class="update" onclick="showModal('update')">üì¢</span>
<span id="themeToggle">üåô Mode</span>
</div>
<b>LP DOWNLOADER V4</b>
<span class="menu" onclick="showModal('desc')">‚ò∞</span>
</div>

<div class="owner">
<div>
<div style="font-size:18px;font-weight:bold">LP DOWNLOADER</div>
<div class="badge">WEBSITE</div>
</div>
<div style="text-align:right">
<div style="font-size:10px;opacity:.7">BATAS DOWNLOAD</div>
<b>UNLIMITED</b>
</div>
</div>

<div class="box">
<label style="font-size:12px;color:#888">LINK TIKTOK</label>
<input id="url" placeholder="Tempel link TikTok...">
<select id="format">
<option value="mp4">MP4 (Video)</option>
<option value="mp3">MP3 (Audio)</option>
</select>
<select id="quality">
<option value="hd">HD (Auto)</option>
<option value="sd">SD</option>
</select>
<button id="btn" onclick="getVideo()">KLIK</button>

<div id="preview">
<video id="video" controls></video>
<div>
<span id="title"></span>
<button id="copyTitleBtn">COPY CAPTION</button>
</div>
</div>

<div id="result">
<p class="ready">Siap diunduh</p>
<a id="dl">DOWNLOAD SEKARANG</a>
<p class="tip">Tip Android: klik / tahan untuk simpan</p>
</div>
</div>

<div class="grid">
<div class="stat">
<span class="label">Status:</span>
<span class="val blue">API Active</span>
</div>
<div class="stat">
<span class="label">Server:</span>
<span class="val green">Normal</span>
</div>
<div class="stat">
<span class="label">Pengguna:</span>
<span class="val green" id="userCount">0</span>
</div>
<div class="stat">
<span class="label">Online:</span>
<span class="val blue" id="onlineVal">0</span>
</div>
<div class="stat">
<span class="label">Total Download:</span>
<span class="val green" id="downloadCount">0</span>
</div>
</div>

<!-- CARA PENGGUNAAN -->
<div id="caraPenggunaan">
<b>Cara Menggunakan Fitur LP Downloader:</b><br>
1. Salin link video TikTok yang ingin diunduh.<br>
2. Tempel link pada kolom "LINK TIKTOK".<br>
3. Pilih format <b>MP4</b> untuk video atau <b>MP3</b> untuk audio.<br>
4. Pilih kualitas <b>HD</b> atau <b>SD</b> sesuai kebutuhan.<br>
5. Klik tombol <b>KLIK</b> untuk memulai proses.<br>
6. Setelah preview muncul (untuk MP4), klik tombol <b>DOWNLOAD SEKARANG</b> untuk menyimpan file.<br>
7. Setelah klik tombol <b>DOWNLOAD SEKARANG</b> lalu klik titik tiga yang ada di pojok kanan bawah video dan setelah itu klik tombol <b>DOWNLOAD</b>.<br>
8. Untuk bantuan, hubungi developer melalui tombol WhatsApp di pojok kanan bawah.
</div>

<!-- MODAL -->
<div class="modal" id="descModal">
<span class="modal-close" onclick="closeModal('descModal')">‚úñ</span>
<h3>Tentang Web</h3>
<p>LP Downloader V4 ‚Äì TikTok MP4 & MP3 Downloader<br>‚úî Preview Video<br>‚úî SD / HD Auto<br>‚úî Android & PC Friendly</p>
<h3>Developer</h3>
‚Ä¢Vitz Official<br>‚Ä¢Ady Official<br>‚Ä¢WA: <a href="https://wa.me/6288210002954" target="_blank">Vitz</a>, <a href="https://wa.me/6289604418556" target="_blank">Ady</a>
</div>

<div class="modal" id="updateModal">
<span class="modal-close" onclick="closeModal('updateModal')">‚úñ</span>
<h3>Update Sekarang</h3>
<p>‚úî Tambah fitur MP3 & MP4<br>
‚úî Stabil di Chrome & Android<br>
‚úî Preview video langsung<br>
‚úî WA floating muncul setelah dashboard<br>
‚úî Cara penggunaan fitur LP Downloader<br>
‚úî Copy Caption</p>
<h3>Developer</h3>
‚Ä¢Vitz Official<br>
‚Ä¢Ady Official<br>
‚Ä¢WhatsApp: <a href="https://wa.me/6288210002954" target="_blank">WA Vitz</a>, 
<a href="https://wa.me/6289604418556" target="_blank">WA Ady</a>
</div>

<div id="waContainer">
<div id="waText">Hubungi Developer</div>
<div id="waButtons">
<a href="https://wa.me/6288210002954" target="_blank" class="waBtn"><img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WA Vitz"></a>
<a href="https://wa.me/6289604418556" target="_blank" class="waBtn"><img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WA Ady"></a>
</div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AlzaSyAliat9KxcZV59oPvEarL m6-GxmJYHZVP0",
  authDomain: "lpdownloader-21111.firebaseapp.com",
  databaseURL: "https://lpdownloader-21111-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "lpdownloader-21111",
  storageBucket: "lpdownloader-21111.appspot.com",
  messagingSenderId: "395505695935",
  appId: "1:395505695935"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const urlInput = document.getElementById("url");
const formatSelect = document.getElementById("format");
const qualitySelect = document.getElementById("quality");
const preview = document.getElementById("preview");
const video = document.getElementById("video");
const titleEl = document.getElementById("title");
const dl = document.getElementById("dl");
const result = document.getElementById("result");
const descModal = document.getElementById("descModal");
const updateModal = document.getElementById("updateModal");
const waContainer = document.getElementById("waContainer");
const onlineVal = document.getElementById("onlineVal");
const userCount = document.getElementById("userCount");
const downloadCount = document.getElementById("downloadCount");
const copyTitleBtn = document.getElementById("copyTitleBtn");
const themeToggle = document.getElementById("themeToggle");
const app = document.getElementById("app");
const opening = document.getElementById("opening");

setTimeout(()=>{
  opening.style.display="none";
  app.style.display="block";
  waContainer.style.display="flex";
},10000);

function showModal(type){
  if(type==='desc') descModal.style.display='block';
  if(type==='update') updateModal.style.display='block';
}
function closeModal(id){document.getElementById(id).style.display='none';}

// ===== STATS REALTIME =====
const userRef = db.ref("stats/users");
const onlineRef = db.ref("stats/online");
const downloadRef = db.ref("stats/downloads");

// PENAMBAHAN PENGGUNA REAlTIME
const uid = Date.now() + Math.random();
const myOnlineRef = onlineRef.push(uid);
myOnlineRef.set(true); // online saat masuk
myOnlineRef.onDisconnect().remove(); // hilang saat keluar

// Update total users realtime
userRef.transaction(n => (n||0)+1);
userRef.on("value", snap => userCount.innerText = snap.val()||0);

// Online realtime
onlineRef.on("value", snap => {
    onlineVal.innerText = snap.numChildren() || 0;
});

// Download realtime
downloadRef.on("value", snap => downloadCount.innerText = snap.val()||0);

// DOWNLOAD VIDEO
async function getVideo(){
  const url = urlInput.value.trim();
  const format = formatSelect.value;
  const quality = qualitySelect.value;
  const btn = document.getElementById("btn");
  if(!url){alert("Masukin link TikTok dulu!");return;}
  btn.innerText="PROSES...";
  btn.disabled=true;

  try{
    const r = await fetch(`https://www.tikwm.com/api/?url=${encodeURIComponent(url)}`);
    const j = await r.json();
    if(!j.data) throw 0;

    let videoLink = quality==="hd"? (j.data.hdplay||j.data.play) : j.data.play;
    let finalLink = format==="mp3"? j.data.music : videoLink;

    if(format==="mp4"){video.src=finalLink; preview.style.display="block";}
    else{preview.style.display="none";}
    titleEl.innerText = j.data.title || "TikTok Video";

    dl.onclick = function(e){
        e.preventDefault();
        downloadRef.transaction(n => (n||0)+1);
        setTimeout(()=>window.open(finalLink,"_system"),50);
        return false;
    }

    result.style.display="block";
    btn.innerText="SELESAI";
    urlInput.value="";
  }catch{
    btn.innerText="PROSES";
  }
  btn.disabled=false;
}

urlInput.addEventListener('input', ()=>{document.getElementById("btn").innerText="KLIK";});
copyTitleBtn.addEventListener('click', ()=>{navigator.clipboard.writeText(titleEl.innerText);});

// Theme toggle
let darkMode = true;
themeToggle.addEventListener('click', ()=>{
    darkMode = !darkMode;
    if(darkMode){
        document.documentElement.style.setProperty('--bg','#000');
        document.documentElement.style.setProperty('--card','#141414');
        document.documentElement.style.setProperty('--text','#fff');
        document.documentElement.style.setProperty('--caraText','#fff');
        themeToggle.innerText = 'üåô Mode';
    }else{
        document.documentElement.style.setProperty('--bg','#fff');
        document.documentElement.style.setProperty('--card','#f1f1f1');
        document.documentElement.style.setProperty('--text','#000');
        document.documentElement.style.setProperty('--caraText','#000');
        themeToggle.innerText = '‚òÄÔ∏è Mode';
    }
});
</script>
</body>
</html>
